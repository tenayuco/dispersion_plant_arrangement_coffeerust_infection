---
title: "R Notebook"
output: html_notebook
---

Explanation: This code uses the superComputer's output and transforms it to a general dataBase *dataGeneralAverages.csv*. It is not necessary to run it if one starts from *dataGeneralAverages.csv*. It only works if we have downloaded the output of the superComputer in the **dfPicos** and **dfPromedios** directories.

1. Procedure to reduce the number of steps for visualization. Run only once. 

```{r}
#This function filtrates one row for each 20 rows. This helps to reduce from 30 000 steps (of 0.01 days) per simulation database, to 1500 (of 0.2 days) steps per simulation database. 

Nth.include<-function(dataframe, n)dataframe[(seq(n,to=nrow(dataframe),by=n)),] 


setwd("./bajadaPatung_lattice/dfPromedios/")

#and run a loop to enter each data frame, reduce it and send it to a new directory
for (nombresDF in list.files()){
df<- read.csv(nombresDF, header = TRUE)
df <- Nth.include(df, 50)
write.csv(df,paste0("../dfPromediosNEW/",nombresDF), row.names = FALSE)
}
```

2. Merge all data frames to a big data frame for visualizations

```{r}
#enter the file with all the new reduced data frames and merge them 

setwd("./bajadaPatung_lattice/dfPromediosNEW/")

library(plyr)
datosFig_Espacio <- ldply(list.files(), read.csv, header=TRUE)
# it is important to detach plyr for dplyr to be used
detach(package:plyr)
```

3. Modify some aspects of the data frame for the figures. Save the big data frame and only use this one for future runs. 

```{r}

datosFig_Espacio$patron<- as.character(datosFig_Espacio$patron)
datosFig_Espacio[datosFig_Espacio=="random"] <- "Random (1.99)"
datosFig_Espacio[datosFig_Espacio=="spaced"] <- "Spaced (2.5)"
datosFig_Espacio[datosFig_Espacio=="aggregated"] <- " Aggregated (1.23)"
datosFig_Espacio[datosFig_Espacio=="rows"] <- " Rows (1.54)"

write.csv(datosFig_Espacio,"./dataGeneralAverages.csv", row.names = FALSE)
```


4 Similar procedure to create dataPeaks.csv 

```{r}

library(plyr) 

#https://www.r-bloggers.com/2013/08/date-formats-in-r/


#enter the file (Dfpicos) with all the new reduced data frames and merge them 

setwd("./bajadaPatung_lattice/dfPicos/")

datosPicosPlanta <- ldply(list.files(), read.csv, header=TRUE)
detach(package:plyr)

datosPicosPlanta$Patron<- as.character(datosPicosPlanta$Patron)
datosPicosPlanta$contador <- 1
datosPicosPlanta$ID <- rep(1:(dim(datosPicosPlanta)[1]/50), each= 50)
datosPicosPlanta$TiempoImax <- round(datosPicosPlanta$TiempoImax)

#esto marca los valores de D. Es importante el random es el promedio de esta simulacion
datosPicosPlanta[datosPicosPlanta=="random"] <- "Random (1.99)"
datosPicosPlanta[datosPicosPlanta=="spaced"] <- "Spaced (2.5)"
datosPicosPlanta[datosPicosPlanta=="aggregated"] <- " Aggregated (1.23)"
datosPicosPlanta[datosPicosPlanta=="rows"] <- " Rows (1.54)"


#it is important to detach plyr for dplyr to be used

```

```{r}
write.csv(datosPicosPlanta, "./dataPeaks.csv", row.names = FALSE)
```

